#include "bowser.h"

static char* _bowser_adaptToMaxHeight(char* sourceText, int maxHeight);

t_bowser* bowser_create(int x, int y, int maxHeight) {
	t_bowser* this = new(t_bowser);
	this->update = NULL;

	this->position.x = x;
	this->position.y = y;
	this->position.z = 0;

	char* text =        "------------------\n-------------------\n-------------------\n----------------------\n-----------------------\n----------------------\n---------------------\n-----------------------\n------------------------\n-------------------------\n-------------------------\n-------------------------\n--------------------------\n--------------------------\n-------------------------\n------------------------------\n------------------------------\n------------------------------\n------------------------------\n------------------------------\n------------------------------\n-------------------------------\n--------------------------------\n-------------------------------\n-------------------------------\n-------------------------------\n--------------------------------\n-------------------------------\n-------------------------------\n------------------------------\n-----------------------------\n----------------------------";
	char* colors_text = "000000000000047774\n0000000000004747474\n0000000000047114774\n0000000044411447774744\n00000004114443777444774\n0000044111143377741174\n000041114422433341714\n00000447742224441117744\n004444777422222241111714\n0433344774222222411111174\n0433333342244222224111744\n0433333334433422224711774\n00473333333333422244717174\n00474773333333422444411414\n0004477447733344433344474\n000004444443344333442377444444\n000043333444433423722222377774\n000000443333443334242244247774\n000000044440443342377222222374\n000000000000443342222377722334\n000000000004343342222377722224\n0000000000043343344222377222374\n00000000000433433334222332222374\n0000044400043334333442222222234\n0000473344444333433343772222224\n0000043333474433433342372377724\n00000433334444333433442323772374\n0000433333444433343342222377234\n0004733333444443343344222233224\n000044333347444444433344222224\n00000473344433433433333442224\n0000004440000004004000000444";
	char* colors_back = "000000000000047774\n0000000000004747474\n0000000000047114774\n0000000044411447774744\n00000004114443777444774\n0000044111143377741174\n000041114422433341714\n00000447742224441117744\n004444777422222241111714\n0433344774222222411111174\n0433333342244222224111744\n0433333334433422224711774\n00473333333333422244717174\n00474773333333422444411414\n0004477447733344433344474\n000004444443344333442377444444\n000043333444433423722222377774\n000000443333443334242244247774\n000000044440443342377222222374\n000000000000443342222377722334\n000000000004343342222377722224\n0000000000043343344222377222374\n00000000000433433334222332222374\n0000044400043334333442222222234\n0000473344444333433343772222224\n0000043333474433433342372377724\n00000433334444333433442323772374\n0000433333444433343342222377234\n0004733333444443343344222233224\n000044333347444444433344222224\n00000473344433433433333442224\n0000004440000004004000000444";

	this->text = _bowser_adaptToMaxHeight(text, maxHeight);
	this->colors_text = _bowser_adaptToMaxHeight(colors_text, maxHeight);
	this->colors_back = _bowser_adaptToMaxHeight(colors_back, maxHeight);

	return this;
}

static char* _bowser_adaptToMaxHeight(char* sourceText, int maxHeight) {
	char* text = malloc(strlen(sourceText) + 1);
	text[0] = '\0';

	int i = 0;
	void _appendToText(char* line) {
		if (i <= maxHeight - 1) {
			strcat(text, line);
			strcat(text, "\n");
		}

		i++;
	}
	string_split_and_iterate(sourceText, "\n", _appendToText);
	text[strlen(text) - 1] = '\0';

	return text;
}
